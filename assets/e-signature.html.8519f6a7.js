import{_ as n,o as s,c as a,d as t}from"./app.8441b1ee.js";const p={},e=t(`<h1 id="canvas\u7535\u5B50\u7B7E\u540D" tabindex="-1"><a class="header-anchor" href="#canvas\u7535\u5B50\u7B7E\u540D" aria-hidden="true">#</a> Canvas\u7535\u5B50\u7B7E\u540D</h1><div class="language-vue ext-vue line-numbers-mode"><pre class="language-vue"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>canvas</span> <span class="token attr-name">ref</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>canvas<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>canvas</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">@click</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>cancel<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>\u53D6\u6D88<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">@click</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>save<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>\u4FDD\u5B58<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">setup</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
<span class="token keyword">import</span> <span class="token punctuation">{</span> ref<span class="token punctuation">,</span> reactive<span class="token punctuation">,</span> onMounted <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;vue&#39;</span>
<span class="token comment">// \u914D\u7F6E\u5185\u5BB9</span>
<span class="token keyword">const</span> config <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">width</span><span class="token operator">:</span> <span class="token number">500</span><span class="token punctuation">,</span> <span class="token comment">// \u5BBD\u5EA6</span>
  <span class="token literal-property property">height</span><span class="token operator">:</span> <span class="token number">300</span><span class="token punctuation">,</span> <span class="token comment">// \u9AD8\u5EA6</span>
  <span class="token literal-property property">lineWidth</span><span class="token operator">:</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token comment">// \u7EBF\u5BBD</span>
  <span class="token literal-property property">strokeStyle</span><span class="token operator">:</span> <span class="token string">&#39;#000&#39;</span><span class="token punctuation">,</span> <span class="token comment">// \u7EBF\u6761\u989C\u8272</span>
  <span class="token literal-property property">lineCap</span><span class="token operator">:</span> <span class="token string">&#39;round&#39;</span><span class="token punctuation">,</span> <span class="token comment">// \u8BBE\u7F6E\u7EBF\u6761\u4E24\u7AEF\u5706\u89D2</span>
  <span class="token literal-property property">lineJoin</span><span class="token operator">:</span> <span class="token string">&#39;round&#39;</span><span class="token punctuation">,</span> <span class="token comment">// \u7EBF\u6761\u4EA4\u6C47\u5904\u5706\u89D2</span>
<span class="token punctuation">}</span>

<span class="token comment">// \u4FDD\u5B58\u4E0A\u6B21\u7ED8\u5236\u7684 \u5750\u6807\u53CA\u504F\u79FB\u91CF</span>
<span class="token keyword">const</span> client <span class="token operator">=</span> <span class="token function">reactive</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token literal-property property">offsetX</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token comment">// \u504F\u79FB\u91CF</span>
  <span class="token literal-property property">offsetY</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
  <span class="token literal-property property">endX</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token comment">// \u5750\u6807</span>
  <span class="token literal-property property">endY</span><span class="token operator">:</span> <span class="token number">0</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token keyword">const</span> canvas <span class="token operator">=</span> <span class="token function">ref</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> ctx <span class="token operator">=</span> <span class="token function">ref</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span>

<span class="token comment">// \u5224\u65AD\u662F\u5426\u4E3A\u79FB\u52A8\u7AEF</span>
<span class="token keyword">const</span> mobileStatus <span class="token operator">=</span> <span class="token function">ref</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">Mobile|Android|iPhone</span><span class="token regex-delimiter">/</span><span class="token regex-flags">i</span></span><span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span>navigator<span class="token punctuation">.</span>userAgent<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token comment">// \u53D6\u6D88-\u6E05\u7A7A\u753B\u5E03</span>
<span class="token keyword">const</span> <span class="token function-variable function">cancel</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// \u6E05\u7A7A\u5F53\u524D\u753B\u5E03\u4E0A\u7684\u6240\u6709\u7ED8\u5236\u5185\u5BB9</span>
  ctx<span class="token punctuation">.</span>value<span class="token punctuation">.</span><span class="token function">clearRect</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> config<span class="token punctuation">.</span>width<span class="token punctuation">,</span> config<span class="token punctuation">.</span>height<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token comment">// \u4FDD\u5B58-\u5C06\u753B\u5E03\u5185\u5BB9\u4FDD\u5B58\u4E3A\u56FE\u7247</span>
<span class="token keyword">const</span> <span class="token function-variable function">save</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// \u5C06canvas\u4E0A\u7684\u5185\u5BB9\u8F6C\u6210blob\u6D41</span>
  canvas<span class="token punctuation">.</span>value<span class="token punctuation">.</span><span class="token function">toBlob</span><span class="token punctuation">(</span><span class="token parameter">blob</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">// \u83B7\u53D6\u5F53\u524D\u65F6\u95F4\u5E76\u8F6C\u6210\u5B57\u7B26\u4E32\uFF0C\u7528\u6765\u5F53\u505A\u6587\u4EF6\u540D</span>
    <span class="token keyword">const</span> date <span class="token operator">=</span> Date<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token comment">// \u521B\u5EFA\u4E00\u4E2A a \u6807\u7B7E</span>
    <span class="token keyword">const</span> a <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">&#39;a&#39;</span><span class="token punctuation">)</span>
    <span class="token comment">// \u8BBE\u7F6E a \u6807\u7B7E\u7684\u4E0B\u8F7D\u6587\u4EF6\u540D</span>
    a<span class="token punctuation">.</span>download <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">\${</span>date<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">.png</span><span class="token template-punctuation string">\`</span></span>
    <span class="token comment">// \u8BBE\u7F6E a \u6807\u7B7E\u7684\u8DF3\u8F6C\u8DEF\u5F84\u4E3A \u6587\u4EF6\u6D41\u5730\u5740</span>
    a<span class="token punctuation">.</span>href <span class="token operator">=</span> <span class="token constant">URL</span><span class="token punctuation">.</span><span class="token function">createObjectURL</span><span class="token punctuation">(</span>blob<span class="token punctuation">)</span>
    <span class="token comment">// \u624B\u52A8\u89E6\u53D1 a \u6807\u7B7E\u7684\u70B9\u51FB\u4E8B\u4EF6</span>
    a<span class="token punctuation">.</span><span class="token function">click</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token comment">// \u79FB\u9664 a \u6807\u7B7E</span>
    a<span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token comment">// \u521D\u59CB\u5316</span>
<span class="token keyword">const</span> <span class="token function-variable function">init</span> <span class="token operator">=</span> <span class="token parameter">event</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// \u83B7\u53D6\u504F\u79FB\u91CF\u53CA\u5750\u6807</span>
  <span class="token keyword">const</span> <span class="token punctuation">{</span> offsetX<span class="token punctuation">,</span> offsetY<span class="token punctuation">,</span> pageX<span class="token punctuation">,</span> pageY <span class="token punctuation">}</span> <span class="token operator">=</span> mobileStatus<span class="token punctuation">.</span>value <span class="token operator">?</span> event<span class="token punctuation">.</span>changedTouches<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">:</span> event

  <span class="token comment">// \u4FEE\u6539\u4E0A\u6B21\u7684\u504F\u79FB\u91CF\u53CA\u5750\u6807</span>
  client<span class="token punctuation">.</span>offsetX <span class="token operator">=</span> offsetX
  client<span class="token punctuation">.</span>offsetY <span class="token operator">=</span> offsetY
  client<span class="token punctuation">.</span>endX <span class="token operator">=</span> pageX
  client<span class="token punctuation">.</span>endY <span class="token operator">=</span> pageY

  <span class="token comment">// \u6E05\u9664\u4EE5\u4E0A\u4E00\u6B21 beginPath \u4E4B\u540E\u7684\u6240\u6709\u8DEF\u5F84\uFF0C\u8FDB\u884C\u7ED8\u5236</span>
  ctx<span class="token punctuation">.</span>value<span class="token punctuation">.</span><span class="token function">beginPath</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token comment">// \u6839\u636E\u914D\u7F6E\u6587\u4EF6\u8BBE\u7F6E\u76F8\u5E94\u914D\u7F6E</span>
  ctx<span class="token punctuation">.</span>value<span class="token punctuation">.</span>lineWidth <span class="token operator">=</span> config<span class="token punctuation">.</span>lineWidth
  ctx<span class="token punctuation">.</span>value<span class="token punctuation">.</span>strokeStyle <span class="token operator">=</span> config<span class="token punctuation">.</span>strokeStyle
  ctx<span class="token punctuation">.</span>value<span class="token punctuation">.</span>lineCap <span class="token operator">=</span> config<span class="token punctuation">.</span>lineCap
  ctx<span class="token punctuation">.</span>value<span class="token punctuation">.</span>lineJoin <span class="token operator">=</span> config<span class="token punctuation">.</span>lineJoin
  <span class="token comment">// \u8BBE\u7F6E\u753B\u7EBF\u8D77\u59CB\u70B9\u4F4D</span>
  ctx<span class="token punctuation">.</span>value<span class="token punctuation">.</span><span class="token function">moveTo</span><span class="token punctuation">(</span>client<span class="token punctuation">.</span>endX<span class="token punctuation">,</span> client<span class="token punctuation">.</span>endY<span class="token punctuation">)</span>
  <span class="token comment">// \u76D1\u542C \u9F20\u6807\u79FB\u52A8\u6216\u624B\u52BF\u79FB\u52A8</span>
  window<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span>mobileStatus<span class="token punctuation">.</span>value <span class="token operator">?</span> <span class="token string">&quot;touchmove&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;mousemove&quot;</span><span class="token punctuation">,</span> draw<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token comment">// \u7ED8\u5236</span>
<span class="token keyword">const</span> <span class="token function-variable function">draw</span> <span class="token operator">=</span> <span class="token parameter">event</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// \u83B7\u53D6\u5F53\u524D\u5750\u6807\u70B9\u4F4D</span>
  <span class="token keyword">const</span> <span class="token punctuation">{</span> pageX<span class="token punctuation">,</span> pageY <span class="token punctuation">}</span> <span class="token operator">=</span> mobileStatus<span class="token punctuation">.</span>value <span class="token operator">?</span> event<span class="token punctuation">.</span>changedTouches<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">:</span> event
  <span class="token comment">// \u4FEE\u6539\u6700\u540E\u4E00\u6B21\u7ED8\u5236\u7684\u5750\u6807\u70B9</span>
  client<span class="token punctuation">.</span>endX <span class="token operator">=</span> pageX
  client<span class="token punctuation">.</span>endY <span class="token operator">=</span> pageY

  <span class="token comment">// \u6839\u636E\u5750\u6807\u70B9\u4F4D\u79FB\u52A8\u6DFB\u52A0\u7EBF\u6761</span>
  ctx<span class="token punctuation">.</span>value<span class="token punctuation">.</span><span class="token function">lineTo</span><span class="token punctuation">(</span>pageX<span class="token punctuation">,</span> pageY<span class="token punctuation">)</span>

  <span class="token comment">// \u7ED8\u5236</span>
  ctx<span class="token punctuation">.</span>value<span class="token punctuation">.</span><span class="token function">stroke</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token comment">// \u7ED3\u675F\u7ED8\u5236</span>
<span class="token keyword">const</span> <span class="token function-variable function">cloaseDraw</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// \u7ED3\u675F\u7ED8\u5236</span>
  ctx<span class="token punctuation">.</span>value<span class="token punctuation">.</span><span class="token function">closePath</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token comment">// \u79FB\u9664\u9F20\u6807\u79FB\u52A8\u6216\u624B\u52BF\u79FB\u52A8\u76D1\u542C\u5668</span>
  window<span class="token punctuation">.</span><span class="token function">removeEventListener</span><span class="token punctuation">(</span><span class="token string">&quot;mousemove&quot;</span><span class="token punctuation">,</span> draw<span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token function">onMounted</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// \u8BBE\u7F6E\u5BBD\u9AD8</span>
  canvas<span class="token punctuation">.</span>value<span class="token punctuation">.</span>width <span class="token operator">=</span> config<span class="token punctuation">.</span>width
  canvas<span class="token punctuation">.</span>value<span class="token punctuation">.</span>height <span class="token operator">=</span> config<span class="token punctuation">.</span>height
  <span class="token comment">// \u8BBE\u7F6E\u4E00\u4E2A\u8FB9\u6846</span>
  canvas<span class="token punctuation">.</span>value<span class="token punctuation">.</span>style<span class="token punctuation">.</span>border <span class="token operator">=</span> <span class="token string">&#39;1px solid #000&#39;</span>
  <span class="token comment">// \u521B\u5EFA\u4E0A\u4E0B\u6587</span>
  ctx<span class="token punctuation">.</span>value <span class="token operator">=</span> canvas<span class="token punctuation">.</span>value<span class="token punctuation">.</span><span class="token function">getContext</span><span class="token punctuation">(</span><span class="token string">&#39;2d&#39;</span><span class="token punctuation">)</span>

  <span class="token comment">// \u8BBE\u7F6E\u586B\u5145\u80CC\u666F\u8272</span>
  ctx<span class="token punctuation">.</span>value<span class="token punctuation">.</span>fillStyle <span class="token operator">=</span> <span class="token string">&#39;transparent&#39;</span>
  <span class="token comment">// \u7ED8\u5236\u586B\u5145\u77E9\u5F62</span>
  ctx<span class="token punctuation">.</span>value<span class="token punctuation">.</span><span class="token function">fillRect</span><span class="token punctuation">(</span>
    <span class="token number">0</span><span class="token punctuation">,</span> <span class="token comment">// x \u8F74\u8D77\u59CB\u7ED8\u5236\u4F4D\u7F6E</span>
    <span class="token number">0</span><span class="token punctuation">,</span> <span class="token comment">// y \u8F74\u8D77\u59CB\u7ED8\u5236\u4F4D\u7F6E</span>
    config<span class="token punctuation">.</span>width<span class="token punctuation">,</span> <span class="token comment">// \u5BBD\u5EA6</span>
    config<span class="token punctuation">.</span>height <span class="token comment">// \u9AD8\u5EA6</span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// \u521B\u5EFA\u9F20\u6807/\u624B\u52BF\u6309\u4E0B\u76D1\u542C\u5668</span>
  window<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span>mobileStatus<span class="token punctuation">.</span>value <span class="token operator">?</span> <span class="token string">&quot;touchstart&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;mousedown&quot;</span><span class="token punctuation">,</span> init<span class="token punctuation">)</span>
  <span class="token comment">// \u521B\u5EFA\u9F20\u6807/\u624B\u52BF \u5F39\u8D77/\u79BB\u5F00 \u76D1\u542C\u5668</span>
  window<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span>mobileStatus<span class="token punctuation">.</span>value <span class="token operator">?</span> <span class="token string">&quot;touchend&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;mouseup&quot;</span><span class="token punctuation">,</span> cloaseDraw<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-html ext-html line-numbers-mode"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>canvas</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>canvas</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token special-attr"><span class="token attr-name">onclick</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span><span class="token value javascript language-javascript"><span class="token function">cancel</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span><span class="token punctuation">&quot;</span></span></span><span class="token punctuation">&gt;</span></span>\u53D6\u6D88<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token special-attr"><span class="token attr-name">onclick</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span><span class="token value javascript language-javascript"><span class="token function">save</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span><span class="token punctuation">&quot;</span></span></span><span class="token punctuation">&gt;</span></span>\u4FDD\u5B58<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
  <span class="token comment">// \u914D\u7F6E\u5185\u5BB9</span>
  <span class="token keyword">const</span> config <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">width</span><span class="token operator">:</span> <span class="token number">400</span><span class="token punctuation">,</span> <span class="token comment">// \u5BBD\u5EA6</span>
    <span class="token literal-property property">height</span><span class="token operator">:</span> <span class="token number">200</span><span class="token punctuation">,</span> <span class="token comment">// \u9AD8\u5EA6</span>
    <span class="token literal-property property">lineWidth</span><span class="token operator">:</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token comment">// \u7EBF\u5BBD</span>
    <span class="token literal-property property">strokeStyle</span><span class="token operator">:</span> <span class="token string">&#39;#000&#39;</span><span class="token punctuation">,</span> <span class="token comment">// \u7EBF\u6761\u989C\u8272</span>
    <span class="token literal-property property">lineCap</span><span class="token operator">:</span> <span class="token string">&#39;round&#39;</span><span class="token punctuation">,</span> <span class="token comment">// \u8BBE\u7F6E\u7EBF\u6761\u4E24\u7AEF\u5706\u89D2</span>
    <span class="token literal-property property">lineJoin</span><span class="token operator">:</span> <span class="token string">&#39;round&#39;</span><span class="token punctuation">,</span> <span class="token comment">// \u7EBF\u6761\u4EA4\u6C47\u5904\u5706\u89D2</span>
  <span class="token punctuation">}</span>

  <span class="token comment">// \u83B7\u53D6canvas \u5B9E\u4F8B</span>
  <span class="token keyword">const</span> canvas <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">&#39;canvas&#39;</span><span class="token punctuation">)</span>
  <span class="token comment">// \u8BBE\u7F6E\u5BBD\u9AD8</span>
  canvas<span class="token punctuation">.</span>width <span class="token operator">=</span> config<span class="token punctuation">.</span>width
  canvas<span class="token punctuation">.</span>height <span class="token operator">=</span> config<span class="token punctuation">.</span>height
  <span class="token comment">// \u8BBE\u7F6E\u4E00\u4E2A\u8FB9\u6846</span>
  canvas<span class="token punctuation">.</span>style<span class="token punctuation">.</span>border <span class="token operator">=</span> <span class="token string">&#39;1px solid #000&#39;</span>
  <span class="token comment">// \u521B\u5EFA\u4E0A\u4E0B\u6587</span>
  <span class="token keyword">const</span> ctx <span class="token operator">=</span> canvas<span class="token punctuation">.</span><span class="token function">getContext</span><span class="token punctuation">(</span><span class="token string">&#39;2d&#39;</span><span class="token punctuation">)</span>

  <span class="token comment">// \u8BBE\u7F6E\u586B\u5145\u80CC\u666F\u8272</span>
  ctx<span class="token punctuation">.</span>fillStyle <span class="token operator">=</span> <span class="token string">&#39;transparent&#39;</span>
  <span class="token comment">// \u7ED8\u5236\u586B\u5145\u77E9\u5F62</span>
  ctx<span class="token punctuation">.</span><span class="token function">fillRect</span><span class="token punctuation">(</span>
    <span class="token number">0</span><span class="token punctuation">,</span> <span class="token comment">// x \u8F74\u8D77\u59CB\u7ED8\u5236\u4F4D\u7F6E</span>
    <span class="token number">0</span><span class="token punctuation">,</span> <span class="token comment">// y \u8F74\u8D77\u59CB\u7ED8\u5236\u4F4D\u7F6E</span>
    config<span class="token punctuation">.</span>width<span class="token punctuation">,</span> <span class="token comment">// \u5BBD\u5EA6</span>
    config<span class="token punctuation">.</span>height <span class="token comment">// \u9AD8\u5EA6</span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// \u4FDD\u5B58\u4E0A\u6B21\u7ED8\u5236\u7684 \u5750\u6807\u53CA\u504F\u79FB\u91CF</span>
  <span class="token keyword">const</span> client <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">offsetX</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token comment">// \u504F\u79FB\u91CF</span>
    <span class="token literal-property property">offsetY</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
    <span class="token literal-property property">endX</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token comment">// \u5750\u6807</span>
    <span class="token literal-property property">endY</span><span class="token operator">:</span> <span class="token number">0</span>
  <span class="token punctuation">}</span>

  <span class="token comment">// \u5224\u65AD\u662F\u5426\u4E3A\u79FB\u52A8\u7AEF</span>
  <span class="token keyword">const</span> mobileStatus <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">Mobile|Android|iPhone</span><span class="token regex-delimiter">/</span><span class="token regex-flags">i</span></span><span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span>navigator<span class="token punctuation">.</span>userAgent<span class="token punctuation">)</span><span class="token punctuation">)</span>

  <span class="token comment">// \u521D\u59CB\u5316</span>
  <span class="token keyword">const</span> <span class="token function-variable function">init</span> <span class="token operator">=</span> <span class="token parameter">event</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">// \u83B7\u53D6\u504F\u79FB\u91CF\u53CA\u5750\u6807</span>
    <span class="token keyword">const</span> <span class="token punctuation">{</span> offsetX<span class="token punctuation">,</span> offsetY<span class="token punctuation">,</span> pageX<span class="token punctuation">,</span> pageY <span class="token punctuation">}</span> <span class="token operator">=</span> mobileStatus <span class="token operator">?</span> event<span class="token punctuation">.</span>changedTouches<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">:</span> event

    <span class="token comment">// \u4FEE\u6539\u4E0A\u6B21\u7684\u504F\u79FB\u91CF\u53CA\u5750\u6807</span>
    client<span class="token punctuation">.</span>offsetX <span class="token operator">=</span> offsetX
    client<span class="token punctuation">.</span>offsetY <span class="token operator">=</span> offsetY
    client<span class="token punctuation">.</span>endX <span class="token operator">=</span> pageX
    client<span class="token punctuation">.</span>endY <span class="token operator">=</span> pageY

    <span class="token comment">// \u6E05\u9664\u4EE5\u4E0A\u4E00\u6B21 beginPath \u4E4B\u540E\u7684\u6240\u6709\u8DEF\u5F84\uFF0C\u8FDB\u884C\u7ED8\u5236</span>
    ctx<span class="token punctuation">.</span><span class="token function">beginPath</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token comment">// \u6839\u636E\u914D\u7F6E\u6587\u4EF6\u8BBE\u7F6E\u76F8\u5E94\u914D\u7F6E</span>
    ctx<span class="token punctuation">.</span>lineWidth <span class="token operator">=</span> config<span class="token punctuation">.</span>lineWidth
    ctx<span class="token punctuation">.</span>strokeStyle <span class="token operator">=</span> config<span class="token punctuation">.</span>strokeStyle
    ctx<span class="token punctuation">.</span>lineCap <span class="token operator">=</span> config<span class="token punctuation">.</span>lineCap
    ctx<span class="token punctuation">.</span>lineJoin <span class="token operator">=</span> config<span class="token punctuation">.</span>lineJoin
    <span class="token comment">// \u8BBE\u7F6E\u753B\u7EBF\u8D77\u59CB\u70B9\u4F4D</span>
    ctx<span class="token punctuation">.</span><span class="token function">moveTo</span><span class="token punctuation">(</span>client<span class="token punctuation">.</span>endX<span class="token punctuation">,</span> client<span class="token punctuation">.</span>endY<span class="token punctuation">)</span>
    <span class="token comment">// \u76D1\u542C \u9F20\u6807\u79FB\u52A8\u6216\u624B\u52BF\u79FB\u52A8</span>
    window<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span>mobileStatus <span class="token operator">?</span> <span class="token string">&quot;touchmove&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;mousemove&quot;</span><span class="token punctuation">,</span> draw<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token comment">// \u7ED8\u5236</span>
  <span class="token keyword">const</span> <span class="token function-variable function">draw</span> <span class="token operator">=</span> <span class="token parameter">event</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>event<span class="token punctuation">)</span>
    <span class="token comment">// \u83B7\u53D6\u5F53\u524D\u5750\u6807\u70B9\u4F4D</span>
    <span class="token keyword">const</span> <span class="token punctuation">{</span> pageX<span class="token punctuation">,</span> pageY <span class="token punctuation">}</span> <span class="token operator">=</span> mobileStatus <span class="token operator">?</span> event<span class="token punctuation">.</span>changedTouches<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">:</span> event
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>pageX<span class="token punctuation">,</span> pageY<span class="token punctuation">)</span>
    <span class="token comment">// \u4FEE\u6539\u6700\u540E\u4E00\u6B21\u7ED8\u5236\u7684\u5750\u6807\u70B9</span>
    client<span class="token punctuation">.</span>endX <span class="token operator">=</span> pageX
    client<span class="token punctuation">.</span>endY <span class="token operator">=</span> pageY

    <span class="token comment">// \u6839\u636E\u5750\u6807\u70B9\u4F4D\u79FB\u52A8\u6DFB\u52A0\u7EBF\u6761</span>
    ctx<span class="token punctuation">.</span><span class="token function">lineTo</span><span class="token punctuation">(</span>pageX<span class="token punctuation">,</span> pageY<span class="token punctuation">)</span>

    <span class="token comment">// \u7ED8\u5236</span>
    ctx<span class="token punctuation">.</span><span class="token function">stroke</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token comment">// \u7ED3\u675F\u7ED8\u5236</span>
  <span class="token keyword">const</span> <span class="token function-variable function">cloaseDraw</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">// \u7ED3\u675F\u7ED8\u5236</span>
    ctx<span class="token punctuation">.</span><span class="token function">closePath</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token comment">// \u79FB\u9664\u9F20\u6807\u79FB\u52A8\u6216\u624B\u52BF\u79FB\u52A8\u76D1\u542C\u5668</span>
    window<span class="token punctuation">.</span><span class="token function">removeEventListener</span><span class="token punctuation">(</span><span class="token string">&quot;mousemove&quot;</span><span class="token punctuation">,</span> draw<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token comment">// \u521B\u5EFA\u9F20\u6807/\u624B\u52BF\u6309\u4E0B\u76D1\u542C\u5668</span>
  window<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span>mobileStatus <span class="token operator">?</span> <span class="token string">&quot;touchstart&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;mousedown&quot;</span><span class="token punctuation">,</span> init<span class="token punctuation">)</span>
  <span class="token comment">// \u521B\u5EFA\u9F20\u6807/\u624B\u52BF \u5F39\u8D77/\u79BB\u5F00 \u76D1\u542C\u5668</span>
  window<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span>mobileStatus <span class="token operator">?</span> <span class="token string">&quot;touchend&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;mouseup&quot;</span><span class="token punctuation">,</span> cloaseDraw<span class="token punctuation">)</span>

  <span class="token comment">// \u53D6\u6D88-\u6E05\u7A7A\u753B\u5E03</span>
  <span class="token keyword">const</span> <span class="token function-variable function">cancel</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">// \u6E05\u7A7A\u5F53\u524D\u753B\u5E03\u4E0A\u7684\u6240\u6709\u7ED8\u5236\u5185\u5BB9</span>
    ctx<span class="token punctuation">.</span><span class="token function">clearRect</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> config<span class="token punctuation">.</span>width<span class="token punctuation">,</span> config<span class="token punctuation">.</span>height<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token comment">// \u4FDD\u5B58-\u5C06\u753B\u5E03\u5185\u5BB9\u4FDD\u5B58\u4E3A\u56FE\u7247</span>
  <span class="token keyword">const</span> <span class="token function-variable function">save</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">// \u5C06canvas\u4E0A\u7684\u5185\u5BB9\u8F6C\u6210blob\u6D41</span>
    canvas<span class="token punctuation">.</span><span class="token function">toBlob</span><span class="token punctuation">(</span><span class="token parameter">blob</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token comment">// \u83B7\u53D6\u5F53\u524D\u65F6\u95F4\u5E76\u8F6C\u6210\u5B57\u7B26\u4E32\uFF0C\u7528\u6765\u5F53\u505A\u6587\u4EF6\u540D</span>
      <span class="token keyword">const</span> date <span class="token operator">=</span> Date<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
      <span class="token comment">// \u521B\u5EFA\u4E00\u4E2A a \u6807\u7B7E</span>
      <span class="token keyword">const</span> a <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">&#39;a&#39;</span><span class="token punctuation">)</span>
      <span class="token comment">// \u8BBE\u7F6E a \u6807\u7B7E\u7684\u4E0B\u8F7D\u6587\u4EF6\u540D</span>
      a<span class="token punctuation">.</span>download <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">\${</span>date<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">.png</span><span class="token template-punctuation string">\`</span></span>
      <span class="token comment">// \u8BBE\u7F6E a \u6807\u7B7E\u7684\u8DF3\u8F6C\u8DEF\u5F84\u4E3A \u6587\u4EF6\u6D41\u5730\u5740</span>
      a<span class="token punctuation">.</span>href <span class="token operator">=</span> <span class="token constant">URL</span><span class="token punctuation">.</span><span class="token function">createObjectURL</span><span class="token punctuation">(</span>blob<span class="token punctuation">)</span>
      <span class="token comment">// \u624B\u52A8\u89E6\u53D1 a \u6807\u7B7E\u7684\u70B9\u51FB\u4E8B\u4EF6</span>
      a<span class="token punctuation">.</span><span class="token function">click</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
      <span class="token comment">// \u79FB\u9664 a \u6807\u7B7E</span>
      a<span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,3),o=[e];function c(l,i){return s(),a("div",null,o)}var k=n(p,[["render",c],["__file","e-signature.html.vue"]]);export{k as default};
